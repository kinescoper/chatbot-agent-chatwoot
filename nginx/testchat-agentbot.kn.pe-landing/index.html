<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat AgentBot — testchat-agentbot.kn.pe</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            max-width: 36rem;
            margin: 0 auto;
            padding: 2rem 1rem;
            line-height: 1.5;
            color: #1a1a1a;
        }
        h1 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        p { margin: 0 0 1rem; color: #444; }
    </style>
</head>
<body>
    <h1>Test Chat (AgentBot)</h1>
    <p>Чат с AI-ботом без формы выбора. Откройте пузырь справа внизу и задайте вопрос — ответ придёт от RAG-бэкенда (agent.kn.pe).</p>

    <div id="chatwoot-error" style="display:none;margin-top:1rem;padding:0.75rem;background:#fff3cd;border:1px solid #ffc107;border-radius:8px;font-size:0.9rem;">
      <strong>Виджет чата не загрузился.</strong> <span id="chatwoot-error-detail">Проверьте, что <a href="https://chatwoot.kn.pe" target="_blank" rel="noopener">chatwoot.kn.pe</a> открывается в браузере.</span> Если видите «Слишком много запросов» (429) — подождите минуту и обновите страницу.
    </div>
    <script>
      (function(d,t) {
        var BASE_URL = "https://chatwoot.kn.pe";
        var websiteToken = "J2D2TAacBWuzBbGCfZbZMM1J";
        var errEl = d.getElementById("chatwoot-error");
        var errDetail = d.getElementById("chatwoot-error-detail");
        function showErr(msg) {
          if (errDetail && msg) errDetail.innerHTML = msg;
          if (errEl) errEl.style.display = "block";
        }
        var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
        g.src = BASE_URL + "/packs/js/sdk.js";
        g.async = true;
        g.onload = function() {
          if (!window.chatwootSDK || !window.chatwootSDK.run) {
            showErr("Скрипт Chatwoot загрузился, но API недоступен.");
            return;
          }
          window.chatwootSDK.run({ websiteToken: websiteToken, baseUrl: BASE_URL });
          window.addEventListener("chatwoot:error", function() {
            showErr("Ошибка виджета. Если в Network запрос к /widget вернул 429 — подождите и обновите страницу.");
          }, { once: true });
          setTimeout(function() {
            if (!window._chatwootReady && errEl && errEl.style.display !== "block") {
              showErr("Виджет не ответил вовремя. Часто это <strong>429 Too Many Requests</strong> — подождите минуту и обновите страницу.");
            }
          }, 15000);
        };
        g.onerror = function() { showErr("Не удалось загрузить скрипт Chatwoot. Проверьте, что <a href=\"https://chatwoot.kn.pe\" target=\"_blank\" rel=\"noopener\">chatwoot.kn.pe</a> открывается в браузере."); };
        s.parentNode.insertBefore(g, s);
        setTimeout(function() {
          if (!window.chatwootSDK && errEl && errEl.style.display !== "block") showErr();
        }, 12000);
      })(document, "script");
    </script>
</body>
</html>
